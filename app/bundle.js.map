{"version":3,"sources":["webpack:///webpack/bootstrap d4599a7999fb2a6f2242","webpack:///./app/app.js","webpack:///./app/js/SFMap.js","webpack:///./app/js/DataService.js","webpack:///./app/js/Toolbar.js","webpack:///./app/js/MapSession.js"],"names":["setupEventListeners","mapSessions","MAX_SELECTION","sessionSVG","d3","select","append","attr","window","onRouteSelectionChange","cb","checked","Object","keys","length","alert","nms","value","destroy","$loader","document","querySelector","fetchRoutes","then","routesData","fetchMapData","mapData","style","display","SFMap","projection","geo","mercator","scale","center","translate","mapSVG","geoPath","_renderMap","arteries","neigh","streets","freeways","selectAll","data","features","enter","streetPaths","DataService","fetch","response","status","console","log","json","route","body","promises","push","Promise","all","responses","map","r","vehicleTag","_normalizeVehicles","vehicleLocationsResp","vehicle","Array","isArray","v","Toolbar","routes","$container","_routes","_renderRoutesList","listHtml","forEach","tag","title","innerHTML","join","MapSession","vehicleMap","Map","width","height","routeColor","fetchRouteConfig","routeData","color","routeColorOpposite","oppositeColor","renderRoute","intervalID","autoRefresh","setInterval","updateVehicleLocations","fetchVehicleLocations","vehicles","set","id","newValues","values","renderVehicles","remove","d","lon","lat","xCenter","yCenter","x1","y1","x2","y2","x3","y3","heading","toGeoJson","points","type","geometry","coordinates","obj","point","p","path","stop","text","clearInterval"],"mappings":"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","file":"./app/bundle.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\texports: {},\n \t\t\tid: moduleId,\n \t\t\tloaded: false\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.loaded = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(0);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap d4599a7999fb2a6f2242","import SFMap from './js/SFMap.js';\nimport DataService from './js/DataService.js';\nimport Toolbar from './js/Toolbar.js';\nimport MapSession from './js/MapSession.js';\n\nfunction setupEventListeners(mapSessions) {\n    const MAX_SELECTION = 3;\n    const sessionSVG = d3.select('.overlay-container')\n            .append('svg')\n            .attr('class', 'overlay');\n\n    window.onRouteSelectionChange = (cb) => {\n        if (cb.checked) {\n            if (Object.keys(mapSessions).length >= MAX_SELECTION) {\n                alert('Please uncheck checked routes to select new ones.');\n                cb.checked = false;\n                return;\n            }\n            const nms = new MapSession(cb.value, sessionSVG);\n            mapSessions[cb.value] = nms;\n        } else {\n            const nms = mapSessions[cb.value];\n            nms.destroy();\n            delete mapSessions[cb.value];\n        }\n    }\n}\n\n\nconst $loader = document.querySelector('.loader');\nconst mapSessions = {};\n\n// Setup Toolbar\nDataService.fetchRoutes().then(routesData => new Toolbar(routesData));\n// Setup Map\nDataService.fetchMapData().then((mapData) => {\n    $loader.style.display = 'none';\n    new SFMap(mapData);\n}).then(() => {\n    // Listen for new Map Sessions\n    setupEventListeners(mapSessions);\n});\n\n\n\n\n\n\n\n// WEBPACK FOOTER //\n// ./app/app.js","\nexport default class SFMap {\n    constructor(mapData) {\n        const projection = d3.geo.mercator()\n            .scale(331400)\n            .center([-122.431297, 37.773972])\n            .translate([1200 / 2, 900 / 2]);\n        this.mapSVG = d3.select('.map');\n        this.sessionSVG = d3.select('.overlay');\n        this.geoPath = d3.geoPath(projection);\n        this._renderMap(mapData);\n    }\n\n    _renderMap([arteries, neigh, streets, freeways]) {\n\n        // No time to figure out how to place the street labels properly\n        this.mapSVG.selectAll('path.neighborhoods')\n            .data(neigh.features)\n            .enter()\n            .append('path')\n            .attr('class', 'neighborhoods')\n            .attr('d', this.geoPath);\n        this.mapSVG.selectAll('path.freeways')\n            .data(freeways.features)\n            .enter()\n            .append('path')\n            .attr('class', 'freeways')\n            .attr('d', this.geoPath);\n        this.mapSVG.selectAll('path.arteries')\n            .data(arteries.features)\n            .enter()\n            .append('path')\n            .attr('class', 'arteries')\n            .attr('d', this.geoPath);\n        const streetPaths = this.mapSVG.selectAll('path.streets')\n            .data(streets.features)\n            .enter()\n            .append('path')\n            .attr('class', 'streets')\n            .attr('d', this.geoPath);\n    }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./app/js/SFMap.js","export default class DataService {\n    static fetchRoutes() {\n        return fetch('routes').then((response) => {\n            if (response.status !== 200) {\n                console.log(response);\n            } else {\n                return response.json();\n            }\n        }).then((route) => route.body && route.body.route);\n    }\n\n    static fetchMapData() {\n        const promises = [];\n        promises.push(fetch('arteries.json'));\n        promises.push(fetch('neighborhoods.json'));\n        promises.push(fetch('streets.json'));\n        promises.push(fetch('freeways.json'));\n\n        return Promise.all(promises).then((responses) => {\n            return Promise.all(responses.map(r => r.json()))\n        });\n    }\n\n    static fetchVehicleLocations(vehicleTag) {\n        return fetch(`locations?r=${vehicleTag}`).then((response) => {\n            if (response.status !== 200) {\n                console.log(response);\n            } else {\n                return response.json();\n            }\n        }).then((data) => DataService._normalizeVehicles(data));\n    }\n\n    static _normalizeVehicles(vehicleLocationsResp) {\n        if (!vehicleLocationsResp.body || !vehicleLocationsResp.body.vehicle) {\n            return;\n        } else if (!Array.isArray(vehicleLocationsResp.body.vehicle)) {\n            const v = vehicleLocationsResp.body.vehicle;\n            return [v];\n        }\n        return vehicleLocationsResp.body.vehicle;\n    }\n\n    static fetchRouteConfig(vehicleTag) {\n        return fetch(`routeConfig?r=${vehicleTag}`).then((response) => {\n            if (response.status !== 200) {\n                console.log(response);\n            } else {\n                return response.json();\n            }\n        }).then((route) => route.body && route.body.route);\n    }\n}\n\n\n// WEBPACK FOOTER //\n// ./app/js/DataService.js","export default class Toolbar {\n    constructor(routes) {\n        this.$container = document.querySelector('.checkbox-container');\n        this._routes = routes;\n        this._renderRoutesList(routes);\n    }\n\n    _renderRoutesList(routes) {\n        const listHtml = [];\n        routes.forEach((r) => {\n            listHtml.push(\n                `<label class=\"route-item\">\n                    <input type=\"checkbox\" value=\"${r.tag}\" class=\"js-route-checkbox\"\n                        onclick=\"onRouteSelectionChange(this)\">\n                    ${r.title}\n                </label><br>`);\n        });\n        this.$container.innerHTML = listHtml.join('\\n');\n    }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./app/js/Toolbar.js","import DataService from './DataService.js';\n\nexport default class MapSession {\n    constructor(vehicleTag, sessionSVG) {\n        this.projection = d3.geo.mercator()\n            .scale(331400)\n            .center([-122.431297, 37.773972])\n            .translate([1200 / 2, 900 / 2]);\n        this.vehicleTag = vehicleTag;\n        this.vehicleMap = new Map();\n        const width = 1200;\n        const height = 900;\n        this.sessionSVG = sessionSVG;\n        this.geoPath = d3.geoPath(this.projection);\n        this.routeColor = '#FFE3AE';\n\n        DataService.fetchRouteConfig(vehicleTag).then((routeData) => {\n            this.routeColor = routeData.color;\n            this.routeColorOpposite = routeData.oppositeColor;\n            this.renderRoute(routeData)\n            // this.updateVehicleLocations();\n            this.intervalID = this.autoRefresh();\n        });\n    }\n\n    autoRefresh() {\n        return window.setInterval(() => {\n            this.updateVehicleLocations();\n        }, 2000);\n    }\n\n    updateVehicleLocations() {\n        return DataService.fetchVehicleLocations(this.vehicleTag).then(vehicles => {\n            if (vehicles) {\n                vehicles.forEach((v) => this.vehicleMap.set(v.id, v));\n                const newValues = [];\n                for(let v of this.vehicleMap.values()) {\n                    newValues.push(v);\n                }\n                this.renderVehicles(newValues);\n            }\n        });\n    }\n\n    renderVehicles(vehicles) {\n        // Really want to animate this movement but no time :(\n        this.sessionSVG.selectAll(`.vehicle-${this.vehicleTag}`).remove();\n        this.sessionSVG.selectAll(`.vehicle-direction-${this.vehicleTag}`).remove();\n\n        this.sessionSVG.selectAll(`circle.vehicle-${this.vehicleTag}`)\n            .data(vehicles)\n            .enter()\n            .append('circle')\n            .attr('cx', d => this.projection([d.lon, d.lat])[0])\n            .attr('cy',  d => this.projection([d.lon, d.lat])[1])\n            .attr('id', d => d.id)\n            .attr('r', '8px')\n            .attr('fill', `#${this.routeColor}`)\n            .attr('stroke', `#${this.routeColorOpposite}`)\n            .attr('opacity', '0.85')\n            .attr('stroke-width', '3px')\n            .attr('class', `vehicle vehicle-${this.vehicleTag}`);\n\n        this.sessionSVG.selectAll(`polyline.vehicle-direction-${this.vehicleTag}`)\n            .data(vehicles)\n            .enter()\n            .append('polyline')\n            .attr('class', `vehicle-direction vehicle-direction-${this.vehicleTag}`)\n            .attr('points', d => {\n                const xCenter = this.projection([d.lon, d.lat])[0];\n                const yCenter = this.projection([d.lon, d.lat])[1];\n                const x1 = xCenter - 4;\n                const y1 = yCenter + 4;\n                const x2 = x1 + 4;\n                const y2 = y1 - 8;\n                const x3 = xCenter + 4;\n                const y3 = yCenter + 4;\n                return `${x1}, ${y1}\n                        ${x2}, ${y2}\n                        ${x3}, ${y3}`;\n            })\n            .attr('stroke', `#${this.routeColorOpposite}`)\n            .attr('fill', 'rgba(0, 0, 0, 0)')\n            .attr('stroke-width', '2px')\n            .attr('transform', d => {\n                const xCenter = this.projection([d.lon, d.lat])[0];\n                const yCenter = this.projection([d.lon, d.lat])[1];\n                return `rotate(${d.heading} ${xCenter} ${yCenter})`\n            });\n    }\n\n    renderRoute(route) {\n        function toGeoJson(points) {\n            return points.map(obj => {\n                return {\n                    type: 'Feature',\n                    geometry: {\n                        type: 'LineString',\n                        coordinates: obj.point.map(p => [p.lon, p.lat, 0])\n                    }\n                };\n            });\n        }\n        const routeData = toGeoJson(route.path);\n        this.sessionSVG.selectAll(`path.routepath-${this.vehicleTag}`)\n            .data(routeData)\n            .enter()\n            .append('path')\n            .attr('fill', 'rgba(0, 0, 0, 0)')\n            .attr('stroke-width', '6px')\n            .attr('stroke', `#${route.color}`)\n            .attr('opacity', '0.7')\n            .attr('class', `routepath-${this.vehicleTag}`)\n            .attr('d', this.geoPath);\n\n        this.sessionSVG.selectAll(`circle.routestops-${this.vehicleTag}`)\n            .data(route.stop)\n            .enter()\n            .append('circle')\n            .attr('cx', d => this.projection([d.lon, d.lat])[0])\n            .attr('cy',  d => this.projection([d.lon, d.lat])[1])\n            .attr('id', d => d.id)\n            .attr('r', '3px')\n            .attr('fill', `#${this.routeColorOpposite}`)\n            .attr('opacity', '0.4')\n            .attr('class', `routestops-${this.vehicleTag}`)\n            .append(\"svg:title\")\n            .text(d => d.title);\n    }\n\n    destroy() {\n        window.clearInterval(this.intervalID);\n        this.sessionSVG.selectAll(`.routepath-${this.vehicleTag}`).remove();\n        this.sessionSVG.selectAll(`.routestops-${this.vehicleTag}`).remove();\n        this.sessionSVG.selectAll(`.vehicle-${this.vehicleTag}`).remove();\n        this.sessionSVG.selectAll(`.vehicle-direction-${this.vehicleTag}`).remove();\n    }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./app/js/MapSession.js"],"sourceRoot":""}